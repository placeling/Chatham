/**
 * Created with JetBrains RubyMine.
 * User: imack
 * Date: 12-07-06
 * Time: 10:02 AM
 * To change this template use File | Settings | File Templates.
 */


$(document).ready(function () {

    $('#question_city_name').keypress(function (e) {
        if (e.which == 13) return false;
    });

    $("#question_city_name").focusout(function () {
        var firstResult = $(".pac-container .pac-item:first").text();

        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({"address":firstResult }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                $("#question_city_name").val(firstResult);

                for (var i = 0; i < results[0].address_components.length; i++) {
                    component = results[0].address_components[i];

                    if (jQuery.inArray("country", component.types) >= 0) {
                        $("#country_code").val(component.short_name);
                        break;
                    }
                }

                $("#lat").val(results[0].geometry.location.lat());
                $("#lng").val(results[0].geometry.location.lng());

            }
        });
    });

    var input = document.getElementById('question_city_name');
    var autocomplete = new google.maps.places.Autocomplete(input);

    google.maps.event.addListener(autocomplete, 'place_changed', function () {
        var place = autocomplete.getPlace();
        console.debug(place);
        if (place.geometry) {

            for (var i = 0; i < place.address_components.length; i++) {
                component = place.address_components[i];

                if (jQuery.inArray("country", component.types) >= 0) {
                    $("#country_code").val(component.short_name);
                    break;
                }
            }


            $("#lat").val(place.geometry.location.lat());
            $("#lng").val(place.geometry.location.lng());
        }
    });

    $("#new_question").submit(function () {
        if ($("#lat").val() == 0.0 && $("#lat").val() == 0.0) {
            alert("<%= I18n.t 'question.pick_place' %>");
            $("#question_city_name").focus();
            return false;
        }
    });

});