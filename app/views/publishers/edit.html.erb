<% content_for :javascript_includes do %>
    <%= stylesheet_link_tag 'brown' %>

<% end %>

<% content_for :javascript do %>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#add_user_button").click(function () {
                $("#add_user_button").hide();
                $("#add_user_box").show();
                $("#user_username").focus();
                return false;
            });

            $(".remove_user").click(function () {
                $(this).parent().parent().remove();
            });


            $("#user_username").autocomplete({
                minLength:2,
                html:true,
                select:function (e, ui) {
                    var startText = '<div class="autocomplete_name">'
                    var endText = '</div><div class="autocomplete_location">'
                    var name = ui.item.value.substring(ui.item.value.indexOf(startText) + startText.length, ui.item.value.indexOf(endText));
                    $("#user_username").val(name);
                    return false;
                },
                source:function (req, add) {
                    var url = "/users/search?q=" + encodeURIComponent(req["term"]);

                    $.getJSON(url, function (data) {
                        var users = data.users;
                        var suggestions = [];

                        $.each(users, function (i, val) {
                            var text = "";
                            if (val["picture"]["thumb_url"]) {
                                text = '<div class="autocomplete_thumb"><img class="autocomplete_thumb_img" src="' + val["picture"]["thumb_url"] + '"/></div><div class="autocomplete_thumb_holder"><div class="autocomplete_name">' + val["username"] + '</div><div class="autocomplete_location">' + val["city"] + '</div></div>';
                            } else {
                                text = '<div class="autocomplete_holder"><div class="autocomplete_name">' + val["username"] + '</div><div class="autocomplete_location">' + val["city"] + '</div></div>';
                            }
                            suggestions.push(text);
                        });

                        add(suggestions);
                    });
                }
            });

            // Handling with grid views (adding first and last classes for borders and adding alternate bgs)
            $('.grid .line:even').addClass('even');
            $('.grid .line:first-child').addClass('firstline');
            $('.grid .line:last-child').addClass('lastline');
            // Tabs switching

            $('.header ul a').click(function () {
                $('#box1 .header ul a').removeClass('active');
                $(this).addClass('active'); // make clicked tab active
                $('#box1 .brownContent').hide(); // hide all content
                $('#box1').find('#' + $(this).attr('rel')).show(); // and show content related to clicked tab
                return false;
            });
        });
    </script>
<% end %>

<div class="row-fluid" style="margin: 75px 0 15px 0;">
  <div id="box1" class="box box-100 span12">
    <div class="boxin">
      <div class="header">
        <h3><%= t 'publisher.basics' %></h3>

        <ul>
          <li><a rel="box1-basics" href="#" class=""><%= t 'publisher.basics' %></a></li>
          <li><a rel="box2-home" href="#" class="active"><%= t 'publisher.home_template' %></a></li>
          <li><a rel="box3-css" href="#" class=""><%= t 'publisher.css_template' %></a></li>
          <li><a rel="box4-place" href="#" class=""><%= t 'publisher.place_template' %></a></li>
        </ul>
      </div>
      <%= form_for(@publisher, :class => "basic") do |f| %>
          <div id="box1-basics" class="brownContent" style="display: none;">
            <div class="inner-form">
              <!-- error and information messages -->
              <% if @publisher.errors.any? %>
                  <% @publisher.errors.full_messages.each do |msg| %>
                      <div class="msg msg-error"><p><%= msg %></p></div>
                  <% end %>
              <% end %>

              <!--
              <dl>
                <dt><%= f.label :domain %></dt>
                <dd>
                  <%= f.text_field :domain, :class => "txt" %>
                  <small><%= t 'publisher.domain_notes' %></small>
                </dd>
              </dl>  -->

              <!--
              <dl>
                <dt><%= f.label :google_analytics_code %></dt>
                <dd>
                  <%= f.text_field :google_analytics_code, :class => "txt" %>
                  <small><%= t 'publisher.google_analytics_copy' %></small>
                </dd>
              </dl>
              -->

            </div>
          </div>
          <div id="box2-home" class="brownContent">
            <div class="inner-form">

              <dl>
                <dt><%= f.label :home_liquid_template %></dt>
                <dd>
                  <%= f.text_area :home_liquid_template, :class => "txt", :style => "width:100%;height:500px" %>
                </dd>
              </dl>
            </div>
          </div>
          <div id="box3-css" class="brownContent" style="display: none;">
            <div class="inner-form">

              <dl>
                <dt><%= f.label :css_liquid_template %></dt>
                <dd>
                  <%= f.text_area :css_liquid_template, :class => "txt", :style => "width:100%;height:500px" %>
                </dd>
              </dl>
            </div>
          </div>
          <div id="box4-place" class="brownContent" style="display: none;">
            <div class="inner-form">

              <dl>
                <dt><%= f.label :place_liquid_template %></dt>
                <dd>
                  <%= f.text_area :place_liquid_template, :class => "txt", :style => "width:100%;height:500px" %>
                </dd>
              </dl>
            </div>
          </div>
          <dl>
            <dd>
              <%= f.submit :class => "button" %>
            </dd>
          </dl>
      <% end %>
    </div>
  </div>

</div>


<div class="row-fluid" style="margin: 15px 0 15px 0;">
  <div class="box span12">
    <div class="boxin">
      <div class="header">
        <h3><%= t 'publisher.modules' %></h3>

        <%= link_to(t('publisher.new_module'), new_publisher_publisher_category_path(@publisher), :style => "color:white;", :class => "button") %>
      </div>

      <%= form_for(@publisher, :class => "basic") do |f| %>
          <div class="inner-form">
            <div id="box1-grid" class="brownContent" style="display: block;"><!-- content box 2 for tabs switching (hidden by default) -->
              <form class="plain" action="" method="post" enctype="multipart/form-data">
                <fieldset>
                  <div class="grid"><!-- grid view -->
                    <div class="line even firstline">

                      <% @publisher.publisher_categories.each do |pub_cat| %>
                          <%= render :partial => 'publisher_category_fields', :locals => {publisher_category: pub_cat} %>
                      <% end %>

                    </div>
                  </div>
                </fieldset>
              </form>
            </div>

      <% end %>
      </div>
    </div>

  </div>
</div>


<div class="row-fluid" style="margin: 0 0 15px 0;">
  <% if current_user.admin? || current_user.id == @publisher.user.id %>


      <div id="box2" class="box span5"><!-- box full-width -->
        <div class="boxin">
          <div class="header">
            <h3><%= t 'publisher.authorized_users' %></h3>
            <%= link_to t('basic.add'), nil, :class => "button", :id => "add_user_button", :style => "color:white;" %>
            <span id="add_user_box" style="display: none;">
              <%= form_for :user, :remote => true, :url => add_member_publisher_path(@publisher), :html => {:style => "display:inline"} do |f| %>
                  <%= f.text_field :username %>
                  <%= f.submit :class => "button" %>
              <% end %>
            </span>
          </div>
          <div id="box2-tabular" class="brownContent"><!-- content box 1 for tab switching -->
            <form class="plain" action="" method="post" enctype="multipart/form-data">
              <fieldset>
                <table id="authorized_users" cellspacing="0">
                  <thead><!-- universal table heading -->

                  <tr>
                    <td class="tc first"><%= t 'publisher.user' %></td>

                    <td class="tc last"><%= t 'publisher.actions' %></td>
                  </tr>
                  </thead>
                  <tbody>

                  <% @publisher.permitted_users.each_with_index do |user, i| %>
                      <%= render :partial => "authorized_user", :locals => {:user => user, :i => i, :publisher => @publisher} %>
                  <% end %>
                  </tbody>
                </table>
              </fieldset>
            </form>
          </div>
          <!-- .content#box-1-holder -->
        </div>
      </div>
  <% end %>

  <div id="box2" class="box span5"><!-- box full-width -->
    <div class="boxin">
      <div class="header">
        <h3><%= t 'publisher.admin' %></h3>
      </div>
      <div class="inner-form">

        <dl>
          <dd>
            <%= button_to t('publisher.request_archive'), {:action => "download_archive"}, :confirm => t('publisher.request_confirm', :email => current_user.email, :publisher => @publisher.user.username), :class => "button" %>
          </dd>
        </dl>
      </div>
      <!-- .content#box-1-holder -->
    </div>
  </div>


</div>