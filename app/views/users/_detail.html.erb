<% content_for :javascript_includes do %>
  <script type="text/javascript">
    $(document).ready(function(){
      $('#type_toggle').css({'display':'block','left':$(window).width()/2 - $('#type_toggle').outerWidth(true)/2, 'top':$('#header').outerHeight(true) + $('#userdetails').outerHeight(true) - $('#type_toggle').outerHeight(true)});
      
      $(window).resize(function() {
        $('#type_toggle').css({'left':$(window).width()/2 - $('#type_toggle').outerWidth(true)/2});
      });
      
      $('.email_user').each(function() {
        $(this).qtip({
          content: '<span class="link_holder"><span class="link_header">Link:</span><input type="text" value="'+ $(this).attr("href") + '" class="link_text"></span>',
           position: {
             my: 'bottom right',
             at: 'top center'
           },
           show: {
             event: 'click',
             solo: true
           },
           hide: {
             event: 'click'
           },
           style: {
             classes: 'ui-tooltip-rounded ui-tooltip-shadow',
           }
        });
      });
      
    });
  </script>
<% end %>

<div id="profilepic">
  <%= image_tag user.thumb_url, :alt=>"Profile Pic", :class =>"styled_pic" %>
</div>
<div id="user_overview">
  <div id="tombstones_and_share">
    <div id="tombstones">
      <div id="num_places" class="tombstone">
        <a href="<%= user_path(user) %>" class="no_highlight">
          <p class="count"><%= user.perspectives.count %></p>
          <p class="measure"><%= t('user.places') %></p>
        </a>
      </div>
      <div id="num_following" class="tombstone">
        <% if user.following.count > 0 %><a href="<%= following_user_path(user) %>" class="no_highlight"><% end %>
          <p class="count"><%= user.following.count %></p>
          <p class="measure"><%= t('user.following') %></p>
        <% if user.following.count > 0 %></a><% end %>
      </div>
      <div id="num_followers" class="tombstone">
        <% if user.followers.count > 0 %><a href="<%= followers_user_path(user) %>" class="no_highlight"><% end %>
          <p class="count" id="follower_count"><%= user.followers.count %></p>
          <p class="measure"><%= t('user.followers') %></p>
        <% if user.followers.count > 0 %></a><% end %>
      </div>
      <div class="tombstone_clear"></div>
    </div>
    <div id="profile_share">
        <span class="social">
          <a href="https://twitter.com/share?url=http://www.placeling.com<%= user_path(user) %>&text=<%= u user.username %>" onclick="var D=550,A=450,C=screen.height,B=screen.width,H=Math.round((B/2)-(D/2)),G=0,F=document;window.open(this.href, '', 'left='+H+',top='+G+',width='+D+',height='+A+',personalbar=0,toolbar=0,scrollbars=1,resizable=1');return false;"><%= image_tag "twitter.png", :alt=>"tweet", :class=>"share" %></a>
        </span>
        <span class="social">
          <a href="" onclick="javascript:var d=document,f='https://www.facebook.com/share',l=d.location,e=encodeURIComponent,p='.php?src=bm&v=4&i=1323211438&u='+e('http://www.placeling.com<%= user_path(user) %>')+'&t='+e('<%= u user.username %>');1;try{if (!/^(.*\.)?facebook\.[^.]*$/.test(l.host))throw(0);share_internal_bookmarklet(p)}catch(z) {a=function() {if (!window.open(f+'r'+p,'sharer','toolbar=0,status=0,resizable=1,width=626,height=436'))l.href=f+p};if (/Firefox/.test(navigator.userAgent))setTimeout(a,0);else{a()}}void(0);return false"><%= image_tag "facebook.png", :alt=>"share on facebook", :class=>"share" %></a>
        </span>
        <span class="social">
          <a href="http://www.placeling.com<%= user_path(user) %>" onclick="javascript:return false;" class="email_user"><%= image_tag "email.png", :alt=>"email", :class=>"share" %></a>
        </span>
    </div>
    
  </div>
  
  <div id="summary">
    <p class="username_holder">
      <span class="username"><%= user.username %></span>
      <span id="follow_action">
        <% if current_user != user %>
          <% if current_user && current_user.following.include?(user) %>
            <a rel="nofollow" data-remote="true" data-method="post" href="<%= url_for (:action => 'unfollow', :controller => 'users')%>" class="no_highlight"><span class="follow_link"><%= t('user.unfollow') %></span></a>
          <% else %>
            <a rel="nofollow" data-remote="true" data-method="post" href="<%= url_for (:action => 'follow', :controller => 'users') %>" class="no_highlight"><span class="follow_link"><%= t('user.follow') %></span></a>
          <% end %>
        <% end %>
      </span>
    </p>
    <% if user.city %>
    <p class="city"><%= user.city %></p>
    <% end %>
    <p class="description"><%= user.description %></p>
  </div>
</div>
<div id="type_toggle">
  <% if request.env['PATH_INFO'] == recent_user_path(user) %>
    <ul class="location_types">
      <li class="left active">
        <a class="active" href="<%= user_path(user) %>"><span class="type"><%= t('user.nearby') %></span></a>
      </li>
      <li class="right inactive">
        <span class="type"><%= t('user.recent') %></span>
      </li>
    </ul>
  <% else %>
  <ul class="location_types">
    <li class="left inactive">
      <span class="type"><%= t('user.nearby') %></span>
    </li>
    <li class="right active">
      <a class="active" href="<%= recent_user_path(user) %>"><span class="type"><%= t('user.recent') %></span></a>
    </li>
  </ul>
  <% end %>
</div>
