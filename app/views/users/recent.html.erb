<% content_for :head do %>
  <title><%= t('user.user_head', {:user => @user.username}) %></title>
  <meta name="description" content="<%= t('user.description', {:user => @user.username, :desc => @user.description}) %>">
  <meta property="og:title" content="<%= t('user.user_head', {:user => @user.username}) %>"/>
  <meta property="og:url" content="https://www.placeling.com<%= user_path(@user) %>"/>
  <meta property="og:type" content="person">
  <meta property="og:image" content="<%=  @user.thumb_url %>"/>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<% end %>

<% content_for :javascript_includes do %>
  <script type="text/javascript">
    $(document).ready(function(){
      $(window).resize(function() {
        var height = $(window).height() - $('#header').outerHeight(true) - $('#footerbottom').outerHeight();
        var user_padding = $('#user_details').outerHeight() - $('#user_details').height();
        var perspective_padding = $('#perspectives').outerHeight() - $('#perspectives').height();
        $('#user_details').height(height - user_padding);
        $('#perspectives').height(height - perspective_padding);
      });
      
      $(window).resize();
      
      $('.lightboxGallery').each(function(){
        $('.lightbox', this).lightBox();
      });
      
      $('.star_link').hover(
        function() {
          var source = $('img', this).attr('src');
          if (source.indexOf('unstarred.png') >= 0) {
            $('img', this).attr('src', '<%= asset_path('starred.png') %>');
            $('img', this).css({'opacity':'0.4'});
          }
        }, 
        function() {
          if ($('img', this).css('opacity') == '0.4') {
            $('img', this).attr('src', '<%= asset_path('unstarred.png') %>');
            $('img', this).css({'opacity':'1.0'});
          }
        }
      );
      
      $('.email').each(function() {
        $(this).qtip({
            content: '<span class="link_holder"><span class="link_header">Link:</span><input type="text" value="'+ $(this).attr("href") + '" class="link_text"></span>',
           position: {
             my: 'bottom center',
             at: 'top center'
           },
           show: {
             event: 'click',
             solo: true
           },
           hide: {
             event: 'click'
           },
           style: {
             classes: 'ui-tooltip-rounded ui-tooltip-shadow',
           }
        });
      });
      $('#loading').hide()
      
      <% if @noscroll.nil? %>
      $(window).data('ajaxready', true);
      $('#perspectives').scroll(function(){
        if ($(window).data('ajaxready') == false) return;
        
        if ($('#perspectives').scrollTop() >= ($('#recent_perspectives_list').height() - 1000)) {
          $('#loading').show();
          $(window).data('ajaxready', false);
          $.ajax({
            url: '<%= recent_user_path(@user) %>',
            data: {
              start: $('#recent_perspectives_list').attr('start')
            },
            dataType: 'script',
          });
        }
      });
      <% end %>
    });
    $(window).load(function(){
      /*$(".images").each(function() {
        mosaic(this);
      });*/
      callToDownload();
    });
  </script>
<% end %>

<div id="user_and_content">
  <div id="user_details">
    <div class="toggle_view">
      <ul class="location_types">
        <li class="left active">
          <a class="active" href="<%= user_path(@user) %>"><span class="type"><%= t('user.nearby') %></span></a>
        </li>
        <li class="right inactive">
          <span class="type"><%= t('user.recent') %></span>
        </li>
      </ul>
    </div>
    
    <%= render :partial => "detail", :locals => {:user => @user} %>
  </div>
  <div id="perspectives">
    <% if @perspectives.length > 0 %>
      <div class="place_category recent"><%= t('place.recent_places')%></div>
      <ul id="recent_perspectives_list" start="<%= @perspectives.length %>">
        <% @perspectives.each_with_index do |perspective, index|%>
          <li class="perspective_wrapper" id="perspective_<%=perspective.id %>">
            <%= render :partial => "perspectives/show", :locals => {:perspective => perspective, :source => "magazine"} %>
          </li>
        <% end %>
      </ul>
      <div id="loading"><img id="spinner" src='<%= asset_path('spinner.gif') %>'></div>
    <% else %>
      <div class="nothing">I haven't placemarked anything yet...</div>
    <% end %>
  </div>
</div>
<%= render :partial => "layouts/download", :locals => {:user => @user} %>