<%= error_messages_for :client_application %>
<%-# For infon on nested forms: http://railscasts.com/episodes/196-nested-model-form-part-1 %>
<%= nested_form_for(@perspective, :url => {:controller => "perspectives", :action => "admin_create"}, :method => "post", :html => {:multipart=> true}) do |f|%>
  <% if @perspective.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@perspective.errors.count, "error") %> prohibited this perspective from being saved:</h2>

      <ul>
      <% @perspective.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  
  <% if admin_user? %>
    <div>
      <p class="standout"><%= t'perspective.user' %></p>
      <p>
      <% if @perspective.user.nil? %>
        <input id="username" class="entry_field" name="username" type="text"/>
      <% else %>
        <%= text_field_tag(:username, @perspective.user.username, {:class => "entry_field"})%>
      <% end %>
      </p>
    </div>
  <% end %>

  <div>
    <p class="standout"><%= t'perspective.memo' %></p>
    <%= f.text_area(:memo) %>
  </div>
  
  <div>
    <p class="standout"><%= t'perspective.url' %></p>
    <%= f.text_field(:url, {:class => "entry_field"}) %>
  </div>
  
  <div>
    <%= f.fields_for :pictures do |builder| %>
      <p>
      Photo: <%= builder.file_field :image %>
      <%= builder.link_to_remove "Remove this photo" %>
      </p>
    <% end %>
    <p><%= f.link_to_add "Add a photo", :pictures %></p>
  </div>
  
  <div id="create">
    <%= f.submit :class => 'button', :value => 'create'%>
  </div>
<% end %>


<% content_for :javascript do %>
  <script src="/javascripts/jquery-ui-1.8.13.custom.min.js" type="text/javascript"></script>
  <%= javascript_include_tag :defaults, "nested_form" %>
<% end %>