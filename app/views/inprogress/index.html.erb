<p id="notice"><%= notice %></p>

<% if @red and @red.length > 0 %>
<div class="place_grouping">
  <p class="heading"><%= t'inprogress.red' %></p>
  <table class="locations">
    <tr>
      <th class="locations"></th>
      <th class="locations"><%= t'inprogress.name' %></th>
      <th class="locations"><%= t'inprogress.location' %></th>
      <th class="locations"><%= t'inprogress.latlong' %></th>
      <th class="locations"><%= t'inprogress.action' %></th>
      <th class="locations"><%= t'inprogress.index_notes' %></th>
      <th class="locations"><%= t'inprogress.index_url' %></th>
    </tr>
    <% @red.each do |entry| %>
      <tr>
        <td class="locations light"><%= image_tag("/images/admin/red_light.png") %></td>
        <td class="locations place_name"><%= entry.name %></td>
        <td class="locations unknown_address">
          <% if entry.address %>
            <p><%= entry.address %></p>
          <% end %>
          <% if entry.locality or entry.state_prov %>
            <p>
              <% # following is one line to remove whitespace that would otherwise appear before comma %>
              <% if entry.locality %><%= entry.locality %><% end %><% if entry.state_prov %><% if entry.locality %>, <% end %><%= entry.state_prov %><% end %>
            </p>
          <% end%>
          <% if entry.postal_code %>
            <p><%= entry.postal_code %></p>
          <% end %>
          <% if entry.country %>
            <p><%= entry.country %></p>
          <% end %>
        </td>
        <td class="locations">
          <% if entry.location[0] == 0.0 or entry.location[1] == 0.0 or entry.location.length == 0 %>
            None
          <% else %>
            <%= entry.location[0] %>, <%= entry.location[1] %>
          <% end %>
        </td>
        <td class="locations action"><%= link_to "Fix", edit_user_inprogres_path({:id => entry, :user_id => entry.user}) %></td>
        <td class="locations"><%= simple_format(entry.notes, :class => 'location_notes') %></td>
        <td class="locations"><% if entry.url %><a href="<%= entry.url %>"><%= t'inprogress.index_url' %></a><% end %></td>
        <td class="locations remove"><%= link_to "Remove", user_inprogres_path({:id => entry, :user_id => entry.user}), {:confirm => "Are you sure you want to delete this?\n\nThere's no undo", :method => :delete} %></td>
      </tr>
    <% end %>
  </table>
  
</div>
<% end %>

<% if @yellow and @yellow.length > 0 %>
<div class="place_grouping">
  <p class="heading"><%= t'potential_perspective.yellow' %></p>
  <table class="locations">
    <tr class="locations">
      <th class="locations"></th>
      <th class="locations"><%= t'inprogress.name' %></th>
      <th class="locations"><%= t'inprogress.location' %></th>
      <th class="locations"><%= t'inprogress.action' %></th>
      <th class="locations"><%= t'inprogress.index_notes' %></th>
      <th class="locations"><%= t'inprogress.index_url' %></th>
    </tr>
    <% @yellow.each do |entry| %>
      <tr>
        <td class="locations light"><%= image_tag("/images/admin/yellow_light.png") %></td>
        <td class="locations place_name"><%= entry.name %></td>
        <td class="locations image">
          <p><%= link_to "View on map", map_user_inprogres_path({:id => entry, :user_id => entry.user}) %></p>
        </td>
        <td class="locations action">
          <% if entry.potential_places and entry.potential_places.length > 0 %>
          <ul>
            <p>Is this place:</p>
            <% entry.potential_places.each do |place| %>
              <li><%= link_to place.name, user_inprogres_path(:id => entry, :user_id => entry.user, :gid => place.gid, :ref => place.reference), :method => :put %></li>
            <% end %>
          </ul>
          <p>None of the above? <%= link_to "Create a new place", edit_user_inprogres_path({:id => entry, :user_id => entry.user}) %></p>
          <% else %>
            <p>Unknown place. <%= link_to "Create it", edit_user_inprogres_path({:id => entry, :user_id => entry.user}) %></p>
          <% end %>
        </td>
        <td class="locations"><%= simple_format(entry.notes, :class => 'location_notes') %></td>
        <td class="locations"><% if entry.url %><a href="<%= entry.url %>"><%= t'inprogress.index_url' %></a><% end %></td>
        <td class="locations remove"><%= link_to "Remove", user_inprogres_path({:id => entry, :user_id => entry.user}), {:confirm => "Are you sure you want to delete this?\n\nThere's no undo", :method => :delete} %></td>
      </tr>
    <% end %>
  </table>
</div>
<% end %>

<% if @green and @green.length > 0 %>
<div class="place_grouping">
  <p class="heading"><%= t'inprogress.green' %> <%= link_to "Process", convert_user_inprogress_path(:user_id => @user[0]), :confirm => "Process these?\nThere's no going back", :class => "process" %></p>
  <table class="locations">
    <tr class="locations">
      <th class="locations"></th>
      <th class="locations"><%= t'potential_perspective.name' %></th>
      <th class="locations"><%= t'potential_perspective.location' %></th>
      <th class="locations"><%= t'potential_perspective.action' %></th>
      <th class="locations"><%= t'potential_perspective.index_notes' %></th>
      <th class="locations"><%= t'potential_perspective.index_url' %></th>
    </tr>
    <% @green.each do |entry| %>
      <tr class="locations">
        <td class="locations light"><%= image_tag("/images/admin/green_light.png") %></td>
        <td class="locations place_name"><%= entry.name %></td>
        <td class="locations image"><%= link_to "View on map", map_user_inprogres_path({:id => entry, :user_id => entry.user}) %></td>
        <td class="locations action"><%= link_to "Edit", edit_user_inprogres_path({:id => entry, :user_id => entry.user}) %></td>
        <td class="locations"><%= simple_format(entry.notes, :class => 'location_notes') %></td>
        <td class="locations"><% if entry.url %><a href="<%= entry.url %>"><%= t'inprogress.index_url' %></a><% end %></td>
        <td class="locations remove"><%= link_to "Remove", user_inprogres_path({:id => entry, :user_id => entry.user}), {:confirm => "Are you sure you want to delete this?\n\nThere's no undo", :method => :delete} %></td>
      </tr>
    <% end %>
  </table>
</div>
<% end %>

<% if @black and @black.length > 0 %>
<div class="place_grouping">
  <p class="heading"><%= t'inprogress.black' %></p>
  <table class="locations">
    <tr class="locations">
      <th class="locations"></th>
      <th class="locations"><%= t'potential_perspective.name' %></th>
      <th class="locations"><%= t'potential_perspective.location' %></th>
      <th class="locations"><%= t'potential_perspective.index_notes' %></th>
      <th class="locations"><%= t'potential_perspective.index_url' %></th>
    </tr>
    <% @black.each do |entry| %>
      <tr class="locations">
        <td class="locations light"><%= image_tag("/images/admin/black_light.png") %></td>
        <td class="locations place_name"><%= entry.name %></td>
        <td class="locations image"><%= link_to "View on map", map_user_inprogres_path({:id => entry, :user_id => entry.user}) %></td>
        <td class="locations"><%= simple_format(entry.notes, :class => 'location_notes') %></td>
        <td class="locations"><% if entry.url %><a href="<%= entry.url %>"><%= t'potential_perspective.index_url' %></a><% end %></td>
        <td class="locations remove"><%= link_to "Remove", user_inprogres_path({:id => entry, :user_id => entry.user}), {:confirm => "Are you sure you want to delete this?\n\nThere's no undo", :method => :delete} %></td>
      </tr>
    <% end %>
  </table>
</div>
<% end %>